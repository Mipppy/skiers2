# Timmy's Skiers

## Overview
Timmy's Skiers is web application made for NY Section 2 Nordic Skiing results.  It pulls data from [UnderDog Timing](https://www.Underdogtiming.com) and had inspiration from [Tully Runners](http://www.tullyrunners.com/).  

## Distinctiveness and Complexity
 - Reads data from multiple sites.
 - Creates profiles for each Racer detected by the program.
 - Organizes and displays the data to the user in a understandable, easy to read format
 - Leaderboard of the current top skiers in Varisty
 - Reached out to the owner of the site I scan for data and made arrangements so he doesn't use a different format of data, allowing my code to scan without worrying of missing files due to not being able to detect the racers.
 - Pulls all PDFS links from a site, reads the pdf, and stores it all into a database
 - Users can trigger a rescan of the site, causing a bit of lag for them, but allows anyone to update the site with the recent races.

## Running the program
 Simply navigate the home directory of the project and run
 ```shell
    python manage.py runserver
 ```

## Files

### nordic/*
Default files generated by Django when creating a project.  Unedited

### db.sqlite3
The SQL Database.  Has 3 models
- Racer - used for every skier detected by the program contains their team and first/last name
- Sites - remembering already scanned sites.  Contains the site link and title.
- Result - Keeps track of all race results.  Contains a foreign key to Racer, a time, place, bib, score, racename, and the level at which they raced (Varsity, JV, Beginner, Modified)

### Any __pycache__ folder
Folders generated by python when running.  Unedited

### skiers/migrations
Migrations made when adding new models.

### skiers/static/skiers/*
Image files used in the program

### poetry.lock & pyproject.toml
Files generated when running on Online IDE [Replit](https://www.replit.com).  Unedited

### .gitignore
Default .gitignore file with the built in option for python.  Generated by Github Desktop.  Unedited

### skiers/templates/skiers/layout.html
Layout file used in all other HTML files

### skiers/templates/skiers/index.html
Homepage of the site.

### skiers/templates/skiers/team.html
A page for each detected team.  Will be autofilled with the team data, along with every racer on that team.

### skiers/templates/skiers/search.html
A page for if your query doesn't match only one team/racer.  Contains links to every team/racer that matches your query

### skiers/templates/skiers/tracked_racers.html
A page containing every racer that is currently detected.

### skiers/templates/skiers/racer.html
A page with a racers data, along with the results of every detected race. 

### skiers/templates/skiers/all_team.html
A page containing every team that is currently detected.

### skiers/__init__.py, skiers/apps.py, skiers/tests.py
Default file generated when creating a Django project. Unedited

### skiers/admin.py
Registered all models from skiers/models.py

### skiers/models.py
All models in the Sqlite3 database

### manage.py 
Default manage.py file generated by Django when creating a project.  Unedited

### skiers/urls.py
Created a path to all paths that will be needed.  

### skiers/views.py
Alright, now onto the good stuff.  skiers/views.py is used for determining what will happen when a user sends a request to a path.

#### skiers/views.py - index()
This function loads all recent races, along with gets the top boys and girls from the database, then displays the data on the skiers/templates/skiers/index.html

#### skiers/views.py - rescan()
Calls functions from skiers/helpers/pdf.py that rescan [Underdog Timing](https://www.underdogtiming.com)

#### skiers/views.py - racer()
Pulls racer data from the database, makes it a little more readable, and then displays the data on the skiers/templates/skiers/racer.html

#### skiers/views.py - tracked_racers()
Gets all racers in the database and displays the data on the skiers/templates/skiers/tracked_racers.html

#### skiers/views.py - search()
Checks if the query matches a specfic person/team, and if it does, redirect to that page.  If it doesn't, get all racers/teams that match the query and display it on skiers/templates/skiers/search.html

#### skiers/views.py - teams()
Gets team data and all racers with that team name.  Displays the data to skiers/templates/skiers/team.html

#### skiers/views.py - all_teams()
Gets every team currently detected on the database, and displays it to skiers/templates/skiers/all_team.html

### skiers/helpers/pdf.py
Oh boy, the file behind it all, pdf.py.  This file handles [Underdog Timing](https://www.underdogtiming.com) parsing, all PDF Parsing, inserts everything into the database, and contains smaller functions that are used in skiers/views.py to perform checks and operations

#### skiers/helpers/pdf.py - scanPDFs()
Takes a list as an argument.  Program assumes that the url given is full of urls to scan.  Opens every url in the page, calls parsePDF, and appends the return of it to a list.

#### skiers/helpers/pdf.py - parsePDF()
Takes a list as an argument.  Gets the raw text from each page and returns a list of the text. 

#### skiers/helpers/pdf.py - mainPDFFunc()
The function in charge of scanning [Underdog Timing](https://www.underdogtiming.com) and getting all the Nordic skiing related urls and then returning a list of all the urls found

#### skiers/helpers/pdf.py - PDFreadline()
Takes some text as a argument.  Reads lines of the PDF

#### skiers/helpers/pdf.py - PDFListedData()
Takes urls as a argument.  Calls scanPDFs() to read each PDF.  Returns a massive list of every page of every PDF found on [Underdog Timing](https://www.underdogtiming.com)

#### skiers/helpers/pdf.py - parseRacerData()
This takes the huge list created by PDFListedData() as an argument.  Reads every indiviual line in the huge list, searching for either keywords determining the level of the racer, or a string that matches a regex pattern for the racers result data.  For each line that matches the data, it passes it to function addRaceToDatabase()

#### skiers/helpers/pdf.py - addRaceToDatabase()
Runs a check to determine if the racer exists already or not, using racerExistsAlready(), then calls doesResultExistYet(), passing race and racer data.

#### skiers/helpers/pdf.py - racerExistsAlready()
Takes a string for the racers name as an argument.   Splits the string into a first and lastname, then queries the database with the found first and last names.  If the racer exists, it returns the corresponding Racer object, if they don't exist yet, it creates a entry in the database, and returns the newly created Racer object.

#### skiers/helpers/pdf.py - doesResultExistYet()
Takes the race data and a Racer object as an argument.  Runs additionalScoreShenaggings() to get the real score to be inputted, then checks if a result with the current data exists, and if it does, return None and cancel the entry, if it doesn't quite exist yet, create a new Result in the database, and return it.

#### skiers/helpers/pdf.py - additionalScoreShenaggings()
This is used to convert the score on the PDF's to the tradional Nordic score.  The 5 people with the most points before states automatically qualify, so this is used for the leaderboard on skiers/templates/skiers/index.html

#### skiers/helpers/pdf.py - DirectRacerHit()
This is used by skiers/views.py when a user searches to find if their is a direct match to a team or racer, for the user's convience.

#### skiers/helpers/pdf.py - compareScore()
This is a unused function that would compare 2 Racer's total scores against each other when I was prototyping the leaderboard.

#### skiers/helpers/pdf.py - calcTotalRacerScore()
This is a simple function that calculates a Racer's total score and returns it.  

### Additional Notes
Some data COULD be incorrect.  This is either due to the PDF messing it up (90% of errors are from this) or, rarely, my code (10% of errors are from this).  There are a few repeat PDF's with the exact same data, and I've tried to filter them out a as best as possible, but sometimes due to having different race names, it might slip through.  2 or 3 racer names are messed up for some reason, and I suspect it has something to do with PDF Parsing library used messing the data up somehow.  This project was a blast to make, and I plan to host it on an actual website for all of Section 2 Nordic to use.  Have a good day!  